<!DOCTYPE html>
<html>
<head>
  <title>TaskChain Test</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
    button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    pre { background: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>TaskChain API Tester</h1>
  <div id="output"></div>
  
  <h2>1. Create Task</h2>
  <button onclick="createTask()">Create Task</button>
  
  <h2>2. Claim Task</h2>
  <input id="taskIdClaim" placeholder="Task ID" type="number" />
  <button onclick="claimTask()">Claim Task</button>
  
  <h2>3. Complete Task (Anchor Receipt)</h2>
  <input id="taskIdComplete" placeholder="Task ID" type="number" />
  <button onclick="completeTask()">Complete Task</button>
  
  <h2>4. Get Task Details</h2>
  <input id="taskIdGet" placeholder="Task ID" type="number" />
  <button onclick="getTask()">Get Task</button>

  <script>
    const API = "http://localhost:5000";
    const output = document.getElementById("output");

    function log(msg, isError = false) {
      const div = document.createElement("div");
      div.innerHTML = `<pre class="${isError ? "error" : "success"}">${JSON.stringify(msg, null, 2)}</pre>`;
      output.insertBefore(div, output.firstChild);
    }

    async function createTask() {
      try {
        const deadline = Math.floor(Date.now() / 1000) + (7 * 24 * 60 * 60);
        const res = await fetch(`${API}/task/create`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            metadataHash: "0x1234567890123456789012345678901234567890123456789012345678901234",
            deadline,
            gracePeriod: 86400,
            priority: 1
          })
        });
        const data = await res.json();
        log(data);
      } catch (err) {
        log(err.message, true);
      }
    }

    async function claimTask() {
      try {
        const taskId = document.getElementById("taskIdClaim").value;
        const res = await fetch(`${API}/task/claim`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ taskId: parseInt(taskId), commitment: 1 })
        });
        const data = await res.json();
        log(data);
      } catch (err) {
        log(err.message, true);
      }
    }

    async function completeTask() {
      try {
        const taskId = document.getElementById("taskIdComplete").value;
        const res = await fetch(`${API}/receipt/anchor`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            taskId: parseInt(taskId),
            completedBy: "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266"
          })
        });
        const data = await res.json();
        log(data);
      } catch (err) {
        log(err.message, true);
      }
    }

    async function getTask() {
      try {
        const taskId = document.getElementById("taskIdGet").value;
        const res = await fetch(`${API}/task/${taskId}`);
        const data = await res.json();
        log(data);
      } catch (err) {
        log(err.message, true);
      }
    }
  </script>
</body>
</html>
